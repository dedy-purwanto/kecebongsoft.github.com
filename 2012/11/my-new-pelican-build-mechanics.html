<!DOCTYPE html>
<html lang="en">
<head>
        <title>Dedi Purwanto : My new Pelican build mechanics</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="http://kecebongsoft.com/theme/css/main.css" type="text/css" />
        <link href="http://kecebongsoft.com/" type="application/atom+xml" rel="alternate" title="Dedi Purwanto ATOM Feed" />
        <link href='http://fonts.googleapis.com/css?family=Sanchez|Enriqueta' rel='stylesheet' type='text/css'>

</head>

<body>
        
<header>
    <h1>
        <a href="http://kecebongsoft.com" id="site-title">Dedi Purwanto </a>
        <span style='font-size:11px;color:#cfcfcf;'>-</span>
        <a href='/2010/01/about.html' class='site-links'>Tentang saya</a>
        <a href='/archives.html' class='site-links'>Arsip</a>
        <br /> <br /> <br />
        <a href="http://kecebongsoft.com/2012/11/my-new-pelican-build-mechanics.html" id="page-title">My new Pelican build mechanics</a></h1>
<time datetime="2012-11-17T00:00:00">Sat 17 November 2012</time></header>
<article>
    <p>As you know, my blog is powered by a python static blog engine, named Pelican. I really like it in many ways: simplicity, <em>geekyness</em>, and hostings. Yes, hostings, this blog is hosted with the help of Github user pages, enabling you to create a static website through repository, and accessible with your Github username, plus you don't have to think about reliability and scaling, Github will handle it for you.</p>
<p>Pelican, as a static blog engine, of course will generate static html files that you will have to push to your repository, these auto-generated files are pretty much meaningless, you don't want to 'manage' them, but it has to stay in the repo to serve request, and above that, it has to be placed in the root path of the repository. Meanwhile we also have some other files such as static files, the blog sources (posts, config file, build script, custom themes, etc), and in my case, I also have submodules repository which is a separate static site, they are mostly HTML5 slides.</p>
<p>For me, I always wanted to keep everything clean, whenever I trigger a new build, I wanted to wipe all recent build files first. But I can't just do that with all other necessary files as mentioned, so few things need to be done before I trigger a build:</p>
<ul>
<li>Exclude all git submodules path from deletion.</li>
<li>Exclude files that are not part of pelican auto-generated files.</li>
<li>Wipe the rest.</li>
<li>Trigger the build.</li>
</ul>
<p>While the last one is pretty much straightforward, the first three are quite tricky, but I finally figured it out with a bash script, note that I'm not a bash hacker, you might find my build script an eyesore, well, here it is:</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env bash</span>
<span class="nv">GITMODULES</span><span class="o">=</span><span class="sb">`</span>grep path ../.gitmodules | sed <span class="s1">&#39;s/path = /\\\|/g&#39;</span> | sed <span class="s1">&#39;s/ //g&#39;</span> | sed <span class="s1">&#39;s/\t//g&#39;</span> | tr <span class="s1">&#39;\\n&#39;</span> <span class="s1">&#39;#&#39;</span> | sed <span class="s1">&#39;s/#//g&#39;</span> | sed <span class="s1">&#39;s/^\\\|//g&#39;</span><span class="sb">`</span>
<span class="nv">FILES</span><span class="o">=</span><span class="s1">&#39;README\|pelican\|CNAME\|static&#39;</span>
<span class="nv">EXCEPTIONS</span><span class="o">=</span><span class="nv">$GITMODULES</span><span class="s1">&#39;\|&#39;</span><span class="nv">$FILES</span>
ls ../ | grep -v <span class="nv">$EXCEPTIONS</span> | xargs -i rm -rf ../<span class="o">{}</span>
<span class="nb">source </span>env/bin/activate
pelican . -o ../ -s pelican.conf.py
</pre></div>


<p>First I grab all the submodules path and combine them together with a '\|' separator for regex purpose later, and manually list out all other excluded files with the same regex separator, and then use an inverse grep to delete the others. In my case, the manual list is really static and not always changed, so it will be safe to keep it this way, as for submodules, I have to make it dynamic to reduce the coupling.</p>
</article>

        <footer>
            &copy; 2013 Dedi Purwanto&nbsp;&nbsp;
        </footer>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-36468240-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>